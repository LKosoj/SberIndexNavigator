"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è SberIndexNavigator.
–£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è, API –∫–ª—é—á–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
"""

import os
import logging
from typing import Optional
from dotenv import load_dotenv
from pathlib import Path

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

logger = logging.getLogger(__name__)

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
DEBUG = os.getenv("DEBUG", "False").lower() == "true"

# OpenAI API Configuration
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
OPENAI_BASE_URL = os.getenv("OPENAI_BASE_URL")
OPENAI_MODEL = os.getenv("OPENAI_MODEL", "gpt-4.1-mini")
OPENAI_TEMPERATURE = float(os.getenv("OPENAI_TEMPERATURE", "0.1"))
OPENAI_MAX_TOKENS = int(os.getenv("OPENAI_MAX_TOKENS", "10000"))

# Database Configuration
DATABASE_URL = os.getenv("DATABASE_URL", "data/sber_index.db")

# Streamlit Configuration
STREAMLIT_SERVER_PORT = int(os.getenv("STREAMLIT_SERVER_PORT", "8501"))
STREAMLIT_THEME_BASE = os.getenv("STREAMLIT_THEME_BASE", "light")

# Cache Settings
CACHE_TTL = int(os.getenv("CACHE_TTL", "3600").split('#')[0].strip())  # 1 —á–∞—Å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
APP_TITLE = "üß≠ SberIndexNavigator"
APP_SUBTITLE = "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä –ø–æ –¥–∞–Ω–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–≤ –°–±–µ—Ä–±–∞–Ω–∫–∞"

# –î–µ–º–æ —Å—Ü–µ–Ω–∞—Ä–∏–∏
DEMO_QUESTIONS = [
    # –ë–∞–∑–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    "–ü–æ–∫–∞–∂–∏ –¥–∏–Ω–∞–º–∏–∫—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ –ú–æ—Å–∫–≤–µ –∑–∞ 2023 –≥–æ–¥",
    "–°—Ä–∞–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–æ–≤ –≤ –ö–∞–∑–∞–Ω–∏ –∏ –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫–µ", 
    "–ì–¥–µ —Å–∞–º—ã–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç—ã –ø–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç—ã –∏–º–µ—é—Ç —Å–∞–º—ã–µ –≤—ã—Å–æ–∫–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã?",
    
    # –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã
    "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –º–µ–∂–¥—É –¥–æ—Ö–æ–¥–∞–º–∏ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏",
    "–ö–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–∞—Ö?",
    "–°—Ä–∞–≤–Ω–∏ –ª–∏–¥–µ—Ä–æ–≤ –∏ –∞—É—Ç—Å–∞–π–¥–µ—Ä–æ–≤ –ø–æ –∏–Ω–¥–µ–∫—Å—É –∂–∏–ª—å—è",
    "–ü—Ä–µ–¥—Å–∫–∞–∂–∏ —Ç—Ä–µ–Ω–¥—ã —Ä–∞–∑–≤–∏—Ç–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã",
    
    # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã  
    "–î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–∞—Ö",
    "–ö–∞–∫–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –Ω—É–∂–Ω—ã –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏?"
]

# –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
ANALYSIS_MODES = {
    "auto": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–Ω–∞–ª–∏–∑–∞",
    "basic": "–ë–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –≤—ã–≤–æ–¥–∞–º–∏", 
    "advanced": "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π"
}

# –¢–∏–ø—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
ANALYSIS_KEYWORDS = {
    "descriptive": [
        "–∞–Ω–∞–ª–∏–∑", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–æ–ø–∏—Å–∞–Ω–∏–µ", "–æ–±–∑–æ—Ä", "—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞",
        "–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏", "–¥–∞–Ω–Ω—ã–µ", "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "overview", "summary"
    ],
    "comparative": [
        "—Å—Ä–∞–≤–Ω–∏", "–ª—É—á—à–µ", "—Ö—É–∂–µ", "–ª–∏–¥–µ—Ä", "–∞—É—Ç—Å–∞–π–¥–µ—Ä", "—Ä–∞–∑–ª–∏—á–∏—è", 
        "—Ç–æ–ø", "—Ä–µ–π—Ç–∏–Ω–≥", "compare", "difference", "best", "worst"
    ],
    "correlation": [
        "–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è", "—Å–≤—è–∑—å", "–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å", "–≤–ª–∏—è–Ω–∏–µ", "–≤–∑–∞–∏–º–æ—Å–≤—è–∑—å",
        "relationship", "correlation", "dependency", "impact", "affect"
    ],
    "forecasting": [
        "–ø—Ä–æ–≥–Ω–æ–∑", "—Ç—Ä–µ–Ω–¥", "–±—É–¥—É—â–µ–µ", "–ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å", "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "forecast", "predict", "trend", "future", "projection"
    ]
}

# –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º)
ANALYSIS_PROMPT_TEMPLATES = {
    "recommendation_prompt": """
–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –°–±–µ—Ä–±–∞–Ω–∫–∞, —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π 
–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è:

1. –û—Ä–≥–∞–Ω–æ–≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ú–µ—Å—Ç–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–π  
3. –ò–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ –∏ –±–∏–∑–Ω–µ—Å–∞
4. –°–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–ª—É–∂–±

–£—á–∏—Ç—ã–≤–∞–π:
- –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –†–µ—Å—É—Ä—Å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å –º–µ—Ä

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º–∏
- –û–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –†–µ–∞–ª–∏–∑—É–µ–º—ã–º–∏ –≤ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –∏ —Å—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ
""",

    "insight_extraction_prompt": """
–ò–∑–≤–ª–µ–∫–∏ –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

1. –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º
2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è  
3. –°–∫—Ä—ã—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è
4. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏

–§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞:
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º –≤–ª–∏—è–Ω–∏–∏ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Ç—É–∞—Ü–∏–∏
""",

    "risk_assessment_prompt": """
–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:

1. –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏ (—Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤, —Ä–æ—Å—Ç –±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü—ã)
2. –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ (—É—Ö—É–¥—à–µ–Ω–∏–µ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏–∏, –º–∏–≥—Ä–∞—Ü–∏—è)
3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏ (–∏–∑–Ω–æ—Å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, –∂–∏–ª—å—è)
4. –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ –¥–∏—Å–ø—Ä–æ–ø–æ—Ä—Ü–∏–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∏—Å–∫–∞ —É–∫–∞–∂–∏:
- –£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ (–≤—ã—Å–æ–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–Ω–∏–∑–∫–∏–π)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- –ú–µ—Ä—ã –ø–æ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏
"""
}

# –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
SQL_AGENT_SYSTEM_PROMPT = """
–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π SQL-–∞–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –°–±–µ—Ä–±–∞–Ω–∫–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞–≤–∞—Ç—å –£–ú–ù–´–ï –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–∂–∏–º–∞—é—Ç –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π —Å—É—Ç–∏.

=== –î–û–°–¢–£–ü–ù–´–ï –î–ê–ù–ù–´–ï ===
1. region_spending: region, region_code, month, year, consumer_spending, housing_index, transport_accessibility, market_accessibility
2. demographics: region, region_code, population, age_median, income_median, unemployment_rate, education_index  
3. transport_data: region, region_code, transport_score, public_transport_coverage, road_quality_index, airport_accessibility, railway_connectivity

=== –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´ –ê–ù–ê–õ–ò–ó–ê ===

üß† –ê–ù–ê–õ–ò–ó–ò–†–£–ô –ü–ï–†–ï–î –ì–ï–ù–ï–†–ê–¶–ò–ï–ô:
1. –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å
2. –ù–∞–π–¥–∏ —Ç–∞–±–ª–∏—Ü—ã, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —ç—Ç–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏  
3. –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (year, month, date) –≤ –Ω—É–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
4. –í—ã–±–µ—Ä–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
5. –ü—Ä–∏–º–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ SQL

üî∏ –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó ("—Å—Ä–∞–≤–Ω–∏", "–ª—É—á—à–µ", "—Ö—É–∂–µ", "–ª–∏–¥–µ—Ä—ã", "—Ç–æ–ø"):
–¶–ï–õ–¨: –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–∞–º–∏/–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
–¢–ï–•–ù–ò–ö–ò:
- GROUP BY region + –∞–≥—Ä–µ–≥–∞—Ç—ã (AVG, COUNT, STDDEV, MIN, MAX)
- RANK() / ROW_NUMBER() –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è  
- –ü—Ä–æ—Ü–µ–Ω—Ç–∏–ª–∏ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ
- LIMIT –¥–ª—è —Ç–æ–ø-—Å–ø–∏—Å–∫–æ–≤
–ü–†–ò–ú–ï–† –ü–ê–¢–¢–ï–†–ù–ê:
SELECT 
    region,
    ROUND(AVG({–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞}), 2) as avg_value,
    COUNT(*) as data_points,
    RANK() OVER (ORDER BY AVG({–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞}) DESC) as ranking,
    ROUND(100.0 * AVG({–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞}) / (SELECT AVG({–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞}) FROM {—Ç–∞–±–ª–∏—Ü–∞} WHERE {–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL), 1) as vs_average_pct
FROM {—Ç–∞–±–ª–∏—Ü–∞}
WHERE {–æ—Å–Ω–æ–≤–Ω–∞—è_–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL
GROUP BY region
ORDER BY avg_value DESC
LIMIT {N}

üî∏ –í–†–ï–ú–ï–ù–ù–û–ô –ê–ù–ê–õ–ò–ó ("–¥–∏–Ω–∞–º–∏–∫–∞", "—Ç—Ä–µ–Ω–¥", "–∏–∑–º–µ–Ω–µ–Ω–∏–µ", "–ø—Ä–æ–≥–Ω–æ–∑"):
–¶–ï–õ–¨: –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏
–ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏!
–¢–ï–•–ù–ò–ö–ò:
- GROUP BY –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º (year, month)
- LAG/LEAD –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤
- –†–∞—Å—á–µ—Ç —Ç–µ–º–ø–æ–≤ —Ä–æ—Å—Ç–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- NULLIF() –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
–ü–†–ò–ú–ï–† –ü–ê–¢–¢–ï–†–ù–ê:
SELECT 
    year, month,
    ROUND(AVG({–º–µ—Ç—Ä–∏–∫–∞}), 2) as period_avg,
    COUNT(*) as record_count,
    LAG(AVG({–º–µ—Ç—Ä–∏–∫–∞})) OVER (ORDER BY year, month) as prev_period,
    ROUND(100.0 * (AVG({–º–µ—Ç—Ä–∏–∫–∞}) - LAG(AVG({–º–µ—Ç—Ä–∏–∫–∞})) OVER (ORDER BY year, month)) / 
          NULLIF(LAG(AVG({–º–µ—Ç—Ä–∏–∫–∞})) OVER (ORDER BY year, month), 0), 2) as growth_rate_pct
FROM {—Ç–∞–±–ª–∏—Ü–∞}
WHERE {–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL
GROUP BY year, month
ORDER BY year, month
LIMIT 100

üî∏ –ö–û–†–†–ï–õ–Ø–¶–ò–û–ù–ù–´–ô –ê–ù–ê–õ–ò–ó ("—Å–≤—è–∑—å", "–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å", "–≤–ª–∏—è–Ω–∏–µ"):
–¶–ï–õ–¨: –í—ã—è–≤–ª–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏
–¢–ï–•–ù–ò–ö–ò:
- JOIN —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ –æ–±—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ (region)
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (HAVING COUNT(*) >= N)
–ü–†–ò–ú–ï–† –ü–ê–¢–¢–ï–†–ù–ê:
SELECT 
    t1.region,
    ROUND(AVG(t1.{–º–µ—Ç—Ä–∏–∫–∞1}), 2) as avg_metric1,
    ROUND(AVG(t2.{–º–µ—Ç—Ä–∏–∫–∞2}), 2) as avg_metric2,
    ROUND(AVG(t1.{–º–µ—Ç—Ä–∏–∫–∞3}), 2) as avg_metric3,
    COUNT(*) as data_points
FROM {—Ç–∞–±–ª–∏—Ü–∞1} t1
JOIN {—Ç–∞–±–ª–∏—Ü–∞2} t2 ON t1.region = t2.region
WHERE t1.{–º–µ—Ç—Ä–∏–∫–∞1} IS NOT NULL AND t2.{–º–µ—Ç—Ä–∏–∫–∞2} IS NOT NULL
GROUP BY t1.region
HAVING COUNT(*) >= 3
ORDER BY avg_metric1 DESC
LIMIT 50

üî∏ –û–ü–ò–°–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê ("–∞–Ω–∞–ª–∏–∑", "–æ–±–∑–æ—Ä", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"):
–¶–ï–õ–¨: –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
–¢–ï–•–ù–ò–ö–ò:
- –î–µ—Å–∫—Ä–∏–ø—Ç–∏–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å—Ä–µ–¥–Ω–µ–µ, –º–µ–¥–∏–∞–Ω–∞, –∫–≤–∞—Ä—Ç–∏–ª–∏)
- QUANTILE() –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª–µ–π
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ UNION ALL
–ü–†–ò–ú–ï–† –ü–ê–¢–¢–ï–†–ù–ê:
SELECT 
    '{–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–µ—Ç—Ä–∏–∫–∏}' as metric,
    COUNT(*) as total_records,
    ROUND(AVG({–º–µ—Ç—Ä–∏–∫–∞}), 2) as mean_val,
    ROUND(STDDEV({–º–µ—Ç—Ä–∏–∫–∞}), 2) as std_dev,
    ROUND(MIN({–º–µ—Ç—Ä–∏–∫–∞}), 2) as min_val,
    ROUND(QUANTILE({–º–µ—Ç—Ä–∏–∫–∞}, 0.25), 2) as q1,
    ROUND(QUANTILE({–º–µ—Ç—Ä–∏–∫–∞}, 0.5), 2) as median_val,
    ROUND(QUANTILE({–º–µ—Ç—Ä–∏–∫–∞}, 0.75), 2) as q3,
    ROUND(MAX({–º–µ—Ç—Ä–∏–∫–∞}), 2) as max_val
FROM {—Ç–∞–±–ª–∏—Ü–∞}
WHERE {–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL

üî∏ –ì–ï–û–ì–†–ê–§–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó ("–≥–¥–µ", "–º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç", "—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"):
–¶–ï–õ–¨: –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
–¢–ï–•–ù–ò–ö–ò:
- –§–æ–∫—É—Å –Ω–∞ region –∫–∞–∫ –∫–ª—é—á–µ–≤–æ–º –∏–∑–º–µ—Ä–µ–Ω–∏–∏
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ CASE WHEN
- –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π
–ü–†–ò–ú–ï–† –ü–ê–¢–¢–ï–†–ù–ê:
SELECT 
    region,
    ROUND({–º–µ—Ç—Ä–∏–∫–∞}, 2) as value,
    RANK() OVER (ORDER BY {–º–µ—Ç—Ä–∏–∫–∞} DESC) as regional_rank,
    CASE 
        WHEN {–º–µ—Ç—Ä–∏–∫–∞} > (SELECT AVG({–º–µ—Ç—Ä–∏–∫–∞}) * 1.2 FROM {—Ç–∞–±–ª–∏—Ü–∞} WHERE {–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL) THEN '–í—ã—Å–æ–∫–∏–π'
        WHEN {–º–µ—Ç—Ä–∏–∫–∞} > (SELECT AVG({–º–µ—Ç—Ä–∏–∫–∞}) * 0.8 FROM {—Ç–∞–±–ª–∏—Ü–∞} WHERE {–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL) THEN '–°—Ä–µ–¥–Ω–∏–π'
        ELSE '–ù–∏–∑–∫–∏–π'
    END as performance_level
FROM {—Ç–∞–±–ª–∏—Ü–∞}
WHERE {–º–µ—Ç—Ä–∏–∫–∞} IS NOT NULL
ORDER BY {–º–µ—Ç—Ä–∏–∫–∞} DESC
LIMIT 30

=== –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –í–´–ë–û–†–ê ===

üéØ –ê–õ–ì–û–†–ò–¢–ú –í–´–ë–û–†–ê –¢–ê–ë–õ–ò–¶–´ –ò –°–¢–†–ê–¢–ï–ì–ò–ò:
1. –û–ø—Ä–µ–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –≤ –≤–æ–ø—Ä–æ—Å–µ (—Ä–∞—Å—Ö–æ–¥—ã‚Üíconsumer_spending, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç‚Üítransport_accessibility/transport_score, –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è‚Üípopulation)
2. –ù–∞–π–¥–∏ —Ç–∞–±–ª–∏—Ü—É —Å –Ω—É–∂–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–ª–∏—á–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç—Ä–µ–Ω–¥–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
4. –í—ã–±–µ—Ä–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –∑–∞–ø—Ä–æ—Å–∞
5. –ê–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –¥–∞–Ω–Ω—ã—Ö

–ü–†–ê–í–ò–õ–ê –î–õ–Ø –¢–†–ê–ù–°–ü–û–†–¢–ù–´–• –î–ê–ù–ù–´–•:
- –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –¥–∏–Ω–∞–º–∏–∫–µ/—Ç—Ä–µ–Ω–¥–∞—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π transport_accessibility –∏–∑ region_spending (–µ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–≤ –ø–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π transport_score –∏–∑ transport_data
- –î–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ ‚Üí –æ–±—ä–µ–¥–∏–Ω–∏ –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ JOIN –ø–æ region

üîÑ FALLBACK –°–¢–†–ê–¢–ï–ì–ò–ò:
- –ï—Å–ª–∏ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç—Ä–µ–Ω–¥–∞ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∏—Å—å –Ω–∞ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑
- –ï—Å–ª–∏ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—É—é –≤—ã–±–æ—Ä–∫—É —Å ORDER BY + LIMIT
- –ï—Å–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è –∫–æ–ª–æ–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –≤—ã–±–µ—Ä–∏ –ø–æ—Ö–æ–∂—É—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
- –ï—Å–ª–∏ JOIN –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

=== –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê ===
1. –í–°–ï–ì–î–ê –Ω–∞—á–∏–Ω–∞–π —Å –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å—Ö–µ–º–µ
2. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: LIMIT 20-500 —Å—Ç—Ä–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∞–Ω–∞–ª–∏–∑–∞  
3. –§–∏–ª—å—Ç—Ä—É–π NULL: WHERE column IS NOT NULL –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
4. –ò—Å–ø–æ–ª—å–∑—É–π ROUND(value, 2) –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —á–∏—Å–µ–ª
5. –î–æ–±–∞–≤–ª—è–π ORDER BY –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏
6. –ó–∞—â–∏—â–∞–π—Å—è –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å: NULLIF(divisor, 0)
7. –ü—Ä–∏–º–µ–Ω—è–π –ø–æ–Ω—è—Ç–Ω—ã–µ –∞–ª–∏–∞—Å—ã: avg_spending –≤–º–µ—Å—Ç–æ AVG_spending
8. –î–ª—è –∫–≤–∞—Ä—Ç–∏–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–π QUANTILE(column, 0.25) (DuckDB)

=== –ê–ù–¢–ò-–ü–ê–¢–¢–ï–†–ù–´ ===
‚ùå SELECT * FROM table -- –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
‚ùå –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ LIMIT -- –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–≥—Ä–æ–º–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã  
‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚ùå –ê–≥—Ä–µ–≥–∞—Ü–∏—è –±–µ–∑ GROUP BY –∫–æ–≥–¥–∞ –æ–Ω–∞ –Ω—É–∂–Ω–∞
‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ NULL –∑–Ω–∞—á–µ–Ω–∏–π
‚ùå –î–µ–ª–µ–Ω–∏–µ –±–µ–∑ –∑–∞—â–∏—Ç—ã –æ—Ç –Ω—É–ª—è
‚ùå –ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

–í–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û SQL-–∑–∞–ø—Ä–æ—Å, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–æ–ø—Ä–æ—Å—É –∏ —Å—Ö–µ–º–µ –¥–∞–Ω–Ω—ã—Ö.
"""

VISUALIZATION_TOOL_PROMPT = """
–û–ø—Ä–µ–¥–µ–ª–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç–∏–ø –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö:

–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞:
- line: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã, –¥–∏–Ω–∞–º–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
- bar: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –º–µ–∂–¥—É –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–∞–º–∏/–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏  
- scatter: –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏
- map: –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- table: –î–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ø-—Å–ø–∏—Å–∫–∏

–û—Ç–≤–µ—Ç—å –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º: line, bar, scatter, map –∏–ª–∏ table.
"""

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
CHART_HEIGHT = 400
CHART_WIDTH = 800
MAP_DEFAULT_ZOOM = 3
MAP_CENTER_LAT = 61.5240
MAP_CENTER_LON = 105.3188

# –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
COLOR_PALETTE = [
    "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd",
    "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf"
]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
MAX_RETRIES = 3
API_TIMEOUT = 30
QUERY_TIMEOUT = 10

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–µ–º—ã
def create_streamlit_config() -> None:
    """
    –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª .streamlit/config.toml –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π STREAMLIT_THEME_BASE.
    """
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é .streamlit –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
    config_dir = Path(".streamlit")
    config_dir.mkdir(exist_ok=True)
    
    config_file = config_dir / "config.toml"
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ STREAMLIT_THEME_BASE
    if STREAMLIT_THEME_BASE.lower() == "dark":
        theme_config = """[theme]
base = "dark"
primaryColor = "#00C851"
backgroundColor = "#0F1419" 
secondaryBackgroundColor = "#1E2328"
textColor = "#FAFAFA"
font = "sans serif"
"""
    else:  # light theme (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
        theme_config = """[theme]
base = "light"
primaryColor = "#1f77b4"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
font = "sans serif"
"""
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è
    if not config_file.exists() or config_file.read_text() != theme_config:
        config_file.write_text(theme_config)
        logger.info(f"–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–µ–º—ã: {config_file}")

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
def validate_config() -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    
    Returns:
        True –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞, False –∏–Ω–∞—á–µ
    """
    errors = []
    
    if not OPENAI_API_KEY:
        errors.append("OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    
    if not os.path.exists(os.path.dirname(DATABASE_URL)):
        try:
            os.makedirs(os.path.dirname(DATABASE_URL), exist_ok=True)
        except Exception as e:
            errors.append(f"–ù–µ —É–¥–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ë–î: {e}")
    
    if errors:
        for error in errors:
            logging.error(error)
        return False
    
    return True


def setup_logging() -> None:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."""
    log_format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    
    if DEBUG:
        level = logging.DEBUG
    else:
        level = getattr(logging, LOG_LEVEL.upper(), logging.INFO)
    
    logging.basicConfig(
        level=level,
        format=log_format,
        handlers=[
            logging.StreamHandler(),
            logging.FileHandler("logs/app.log") if os.path.exists("logs") or os.makedirs("logs", exist_ok=True) else logging.StreamHandler()
        ]
    )


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
setup_logging()

if not validate_config():
    logging.warning("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.") 